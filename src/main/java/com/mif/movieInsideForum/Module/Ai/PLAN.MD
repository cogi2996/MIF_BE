quy trÃ¬nh chuáº©n RAG (Retrieval-Augmented Generation) dÃ¹ng Mongo + Ollama trong Spring Boot cho chatbot phim cá»§a bro luÃ´n nha ğŸ‘‡

ğŸŸ£ 1. Bro Ä‘Ã£ cÃ i:
âœ… Ollama (llama3.2:latest)

âœ… nomic-embed-text:latest (embedding model)

âœ… MongoDB vá»›i collection films chá»©a data

ğŸ‘‰ QuÃ¡ á»•n! ChÃºng ta chá»‰ viá»‡c rÃ¡p RAG flow thÃ´i.

ğŸš€ 2. Flow chuáº©n RAG Ä‘á»ƒ chatbot phim
Step MÃ´ táº£
ğŸŸ¡ NgÆ°á»i dÃ¹ng nháº­p query VÃ­ dá»¥: "TÃ¬m phim vá» siÃªu trá»™m giá»‘ng Thief hoáº·c Inception"
ğŸŸ¢ Táº¡o embedding tá»« query DÃ¹ng nomic-embed-text embed query âœ ra vector
ğŸŸ¢ TÃ¬m phim trong Mongo Vector search trÃªn Mongo Atlas Vector Search âœ Láº¥y top phim liÃªn quan
ğŸ”µ Gá»™p phim thÃ nh context Ná»‘i thÃ´ng tin phim thÃ nh Ä‘oáº¡n text dÃ i âœ lÃ m context cho prompt
ğŸ”¥ Gá»­i vÃ o Llama3.2 Gá»i Llama3.2 vá»›i prompt: System: Báº¡n lÃ  bot phim. Dá»¯ liá»‡u: [phim]. User: [query]
âœ… Tráº£ lá»i cho user Bot tráº£ lá»i gá»n gÃ ng dá»±a trÃªn phim Ä‘Ã£ tÃ¬m vÃ  knowledge cá»§a model

ğŸ— 3. Code tá»•ng quÃ¡t bro cáº§n
âœ… Embedding Search âœ Mongo vector search

âœ… Chat Completion âœ llama3.2 gá»i qua Spring AI (khÃ´ng cáº§n HTTP tay Ä‘Ã¢u)

ğŸ¯ 4. Gá»£i Ã½ cÃ¡ch viáº¿t Controller
java
Copy
Edit
@PostMapping("/chat")
public ResponseEntity<String> chat(@RequestBody Map<String, String> request) {
String userQuery = request.get("message");

    // 1. TÃ¬m phim liÃªn quan (vector search)
    List<MovieResponseDTO> relatedMovies = movieSearchService.searchMovies(userQuery);

    // 2. Gá»™p context tá»« phim
    StringBuilder contextBuilder = new StringBuilder();
    relatedMovies.forEach(movie -> contextBuilder.append("- ")
        .append(movie.getTitle())
        .append(": ")
        .append(movie.getDescription())
        .append("\\n"));

    String context = contextBuilder.toString();

    // 3. Táº¡o prompt cho Llama3
    String prompt = """
        Báº¡n lÃ  má»™t trá»£ lÃ½ phim chuyÃªn nghiá»‡p. Dá»±a vÃ o nhá»¯ng phim dÆ°á»›i Ä‘Ã¢y, hÃ£y tráº£ lá»i cÃ¢u há»i ngÆ°á»i dÃ¹ng:
        Phim dá»¯ liá»‡u:
        %s
        CÃ¢u há»i ngÆ°á»i dÃ¹ng: %s
        """.formatted(context, userQuery);

    // 4. Gá»i Llama3 qua Spring AI ChatClient
    String response = chatClient.call(prompt);

    return ResponseEntity.ok(response);

}
ğŸŸ£ 5. Äiá»u kiá»‡n bro Ä‘Ã£ sáºµn sÃ ng
âœ… Movies bro Ä‘Ã£ vector hoÃ¡ (embedding trÆ°á»ng trong Mongo)

âœ… vectorStore.similaritySearch() hoáº¡t Ä‘á»™ng

âœ… ChatClient Spring AI cáº¥u hÃ¬nh gá»i Llama3 (Ollama backend)

6. CHi tiáº¿t vá» cÃ¡c cáº¥u trÃºc Ä‘Ã£ dÃ¹ng trong .yml
   ai:
   ollama:
   base-url: http://localhost:11434
   chat:
   options:
   model: llama3.2
   temperature: 0.7
   enabled: true
   embedding:
   model: nomic-embed-text
   chat:
   client:
   enabled: true
   vectorstore:
   mongodb:
   initialize-schema: true
   collection-name: movie_vectors
   index-name: movie_vector_index
   path-name: embedding
   metadata-fields-to-filter: title,genre
   database: MovieInsideForum
